<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/1.11.18/css/jquery.dataTables.min.css">
  <style>
    body {
      background-color: #f5f8fa;
    }

    .container {
      background-color: #fff;
      border-radius: 5px;
      padding: 20px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      margin-top: 20px;
    }

    .profile-picture {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
  }

  .btn-dark {
    background-color: #343a40;
    border-color: #343a40;
    color: #fff;
  }

  .btn-dark:hover {
      background-color: #23272b;
      border-color: #1d2124;
  }

    
  </style>
</head>
<body>
  <div class="container mt-4">
    <h1>Postulantes para la oferta: <%= @job_offer.title %></h1>

    <%= form_with url: applicants_job_offer_path(@job_offer), method: :get, local: true do |form| %>
      <div class="mb-3">
        <label for="sort_by" class="form-label">Ordenar por:</label>
        <select name="sort_by" id="sort_by" class="form-select">
          <option value="experience">Experiencia</option>
          <option value="location">Ubicación</option>
          <option value="languages">Idiomas</option>
          <option value="score">Puntuación</option>
          <option value="position">Cargo</option>
        </select>
      </div>
      <div class="mb-3">
        <input type="submit" value="Filtrar y Ordenar" class="btn btn-dark">
      </div>

    <% end %>

    <table id="applicantsTable" class="table">
      <thead>
        <tr>
          <th></th>
          <th>Nombre</th>
          <th>Apellido</th>
          <th>Email</th>
          <th>Ubicación</th>
          <th>Contacto</th>
          <th>Tipo de Ingeniería</th>
          <th>Experiencia (años)</th>
          <th>Idiomas</th>
          <th>CV</th>
        </tr>
      </thead>
      <tbody>
        <% @sorted_applicants.each do |applicant| %>
          <tr>
            <td>
              <% if applicant.profile_picture.attached? %>
                  <%= image_tag applicant.profile_picture, class: 'profile-picture' %>
              <% else %>
                  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-person profile-picture" viewBox="0 0 16 16">
                      <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0Zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4Zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10Z"/>
                  </svg>
              <% end %>
            </td>
            <td><%= applicant.first_name %></td>
            <td><%= applicant.last_name %></td>
            <td><%= mail_to applicant.email %></td>
            <td><%= applicant.location %></td>
            <td><%= applicant.contact %></td>
            <td><%= applicant.engineering_type %></td>
            <td><%= applicant.experience %></td>
            <td>
              <%= applicant.languages.select { |language| language != "0" }.join(", ") %>
            </td>
            <td>
              <% if applicant.resume.attached? %>
                <%= link_to 'Ver CV', rails_blob_path(applicant.resume, disposition: "attachment") %>
              <% else %>
                Sin CV
              <% end %>
            </td>
          </tr>
        <% end %>
          
    </table>
  </div>
  <footer class="text-center mt-4">
    <%= link_to "Volver al Dashboard", dashboard_path, class: "btn btn-secondary" %>
  </footer>
  <script>
    $(document).ready(function() {
      $('#applicantsTable').DataTable({
        paging: true,
        searching: true, 
        ordering: true, 
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

</body>
</html>

